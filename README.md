# WeatherAPI
Проба пера на GO. Сервер отвечает на запросы о погоде в городах. Реализация с учетом возможности обработки большого кол-ва пользователей и запросов (кэширование и решение вопросов с блокировками и массовыми запросами).



Сервер обрабатывает запросы GET /weather?city=имя  и передает запросы к какому-то внешнему API. 
В текущей реализации вместо запроса стоит заглушка.

Так как запрос к внешней API как правило "дорогой" и для обеспечения выдерживания нагрузки (много однотипных запросов про один и тот же город) используется кэширование.

Предполагается, что в течение 5 минут погода не меняется и все запросы за этот период считаются, что имеют одинаковый результат для одного города. В случае, если запрос первый, то значение сохраняется в InMemory кэш с ключем по имени города.

Следующие запросы, в течение этого периода получают ответ из быстрого кэша.

Реализованы блокировки для устранения гонок, а также удаления эффекта массоввых однотипных запросов при непопадании в кэш. Использованы: мютексы и singleflight чтобы избежать дублирующих запросов к API.

Раз в минуту работает сервис очистки устаревающего кэша. Оценка устарения идет по времени. С целью оптимизации сначала подсчитывается сколько нужно удалить из кэша и что и потом в краткосрочной блокировке удаляются данные из кэша.


Включена обработка корректного завершения фонового процесса очистки кэша и выключения сервера.

Основной функционал - покрыт тестами.


Запрос для проверки   curl http://localhost:8080/weather?city=Khabarovsk

Результат в виде

{
  "city": "Khabarovsk",
  "temperature": 19.5,
  "description": "Partly cloudy",
  "timestamp": 1768906204
}
